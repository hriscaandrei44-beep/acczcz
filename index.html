<!doctype html>
<h2>Join Room</h2>
<div id="playerBox"></div>
<div id="wordArea"></div>
<div id="revealControls"></div>
</div>


<script>
const createBtn = document.getElementById('createBtn');
createBtn.onclick = async () => {
const mainWord = document.getElementById('mainWord').value;
const specialWord = document.getElementById('specialWord').value;
const players = Number(document.getElementById('players').value);
const specialCount = Number(document.getElementById('specialCount').value);


const r = await fetch('/api/create-room', {
method:'POST', headers:{'content-type':'application/json'},
body: JSON.stringify({mainWord, specialWord, players, specialCount})
});
const j = await r.json();


if(!r.ok){
createStatus.textContent = 'Error: ' + j.error;
return;
}


createStatus.textContent = 'Room created: ' + j.roomId;
hostLinks.innerHTML = `Share this link: <br><input style="width:100%" value="${location.origin + j.joinUrl}" readonly><br>
Host Token:<br><input style="width:100%" value="${j.hostToken}" readonly>`;
};


// ROOM JOIN DETECTION
(function detectRoom(){
const m = location.pathname.match(/\/room\/(.+)/);
if(!m) return;
const roomId = m[1];
playerBox.innerHTML = `<button id=\"joinbtn\">Join Room</button>`;
document.getElementById('joinbtn').onclick = ()=> joinRoom(roomId);
})();


async function joinRoom(roomId){
const r = await fetch(`/api/room/${roomId}/join`,{method:'POST'});
const j = await r.json();
if(!r.ok){ alert(j.error); return; }


sessionStorage.setItem('token', j.token);


if(j.revealed) showWord(j.word);
else waitForReveal(j.token);
}


async function waitForReveal(token){
wordArea.innerHTML = `<div class='word'>Waiting for revealâ€¦</div>`;
const t = setInterval(async()=>{
const r = await fetch(`/api/player/${token}/status`);
const j = await r.json();
if(j.revealed){
clearInterval(t);
showWord(j.word);
